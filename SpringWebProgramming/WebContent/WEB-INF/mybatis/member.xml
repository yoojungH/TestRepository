<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper 
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="member">

	<!-- insert문 작성 -->
	<insert id="insert" parameterType="com.mycompany.myapp.dto.Exam12Member">
		<selectKey keyProperty="mid" resultType="String" order="AFTER">
			select
			member_mid_seq.currval from dual
		</selectKey>
		insert into member
		(mid, mname, mpassword, mdate, mtel, memail, mage,
		maddress, moriginalfilename, msavedfilename, mfilecontent)
		values
		(member_mid_seq.nextval, #{mname}, #{mpassword}, sysdate, #{mtel},
		#{memail}, #{mage}, #{maddress},
		#{moriginalfilename}, #{msavedfilename}, #{mfilecontent})
	</insert>


	<!-- select문 작성 -->
	<select id="selectAll" resultType="com.mycompany.myapp.dto.Exam12Member">
		select mid, mname, mpassword,
		mdate, mtel, memail, mage, maddress
		from member
		order by bno asc
	</select>



	<!-- select by page 작성 -->
	<select id="selectByPage" parameterType="map"
		resultType="com.mycompany.myapp.dto.Exam12Member">
		select *
		from(
		select rownum as r, mid, mname, mpassword, mdate, mtel, memail,mage, maddress
		from(
		select mid, mname, mpassword, mdate, mtel, memail, mage, maddress 
		from member order by mid asc
		)
		where rownum&lt;=#{endNum}
		)
		where r&gt;=#{startNum}
	</select>

	<!-- count all 작성 -->
	<select id="countAll" resultType="int">
		select count(*) from member
	</select>

	<!-- select by bno 작성 -->
	<select id="selectByMid" parameterType="String"
		resultType="com.mycompany.myapp.dto.Exam12Member">
		select * from member where mid=#{mid}
	</select>

	<!-- update 작성 -->
	<update id="updateMhitcount" parameterType="map">		
		update member set mhitcount=#{mhitcount} where mid=#{mid}
	</update>

	<update id="update" parameterType="com.mycompany.myapp.dto.Exam12Member">
		<if test="moriginalfilename != null">
			update member set mname=#{mname}, mtel=#{mtel}, mpassword=#{mpassword}, mdate=sysdate, 
			moriginalfilename=#{moriginalfilename}, msavedfilename=#{msavedfilename},
			mfilecontent=#{mfilecontent} where mid=#{mid}
		</if>
		<if test="moriginalfilename == null">
			update member set mname=#{mname}, mtel=#{mtel}, mpassword=#{mpassword}, mdate=sysdate where mid=#{mid}
		</if>
	</update>

	<!-- delete 작성 -->
	<update id="delete" parameterType="String">
		delete from member where mid=#{mid}
	</update>



</mapper>